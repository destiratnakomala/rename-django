{% extends 'base.html' %}

{% block content %}
<h1>Database: {{ db_name }}</h1>

<!-- Display collections in the selected database with delete, view, and upload buttons -->
<h2>Collections</h2>
<ul>
    {% if collections %}
        {% for collection in collections %}
            <li>
                {{ collection }}
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" name="delete_collection" value="{{ collection }}">Delete</button>
                </form>
                <form method="post" enctype="multipart/form-data" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="collection_name" value="{{ collection }}">
                    <input type="file" name="upload_file" accept=".csv,.xls,.xlsx,.txt" required>
                    <button type="submit" name="upload_file">Upload</button>
                </form>
                <!-- View button for the collection -->
                <a href="{% url 'view_collection_data' db_name=db_name collection_name=collection %}">
                    <button>View</button>
                </a>
            </li>
        {% endfor %}
    {% else %}
        <p>No collections found in this database.</p>
    {% endif %}
</ul>

<!-- Add Collection Form -->
<h2>Add a New Collection</h2>
<form method="post">
    {% csrf_token %}
    <input type="text" name="new_collection_name" placeholder="Collection Name" required>
    <button type="submit" name="add_collection">Add Collection</button>
</form>

<!-- Join Collections Form -->
<!-- Join Collections Form -->
<h2>Join Collections</h2>
<form method="post">
    {% csrf_token %}
    <label for="new_collection_name_join">New Collection Name:</label>
    <input type="text" name="new_collection_name_join" placeholder="New Collection Name" required>
    <br>
    <label for="common_field">Common Field:</label>
    <input type="text" name="common_field" placeholder="Common Field" required>
    <br>
    <label>Select Collections to Join:</label>
    <br>
    {% for collection in collections %}
        <input type="checkbox" name="selected_collections" value="{{ collection }}"> {{ collection }}
        <br>
    {% endfor %}
    <button type="submit" name="join_collections">Join Collections</button>
</form>


{% if connection_error %}
    <p style="color:red;">{{ connection_error }}</p>
{% endif %}

<!-- Button to return to MongoDB Management home -->
<a href="{% url 'mongo_home' %}">
    <button>Back to MongoDB Management</button>
</a>

{% endblock %}
